# ERP EMPRESARIAL - Reglas del Proyecto

## üéØ Contexto
Sistema de gesti√≥n empresarial donde la p√©rdida de datos es INACEPTABLE.
Prioridad: Estabilidad, integridad de datos y mantenibilidad.

---

## üî¥ PRIORIDADES CR√çTICAS

1. **INTEGRIDAD DE DATOS**: Validaci√≥n exhaustiva + error handling en TODA operaci√≥n
2. **NUNCA ELIMINAR**: Solo soft delete (`isActive: false` o `deletedAt`)
3. **MODULARIDAD**: Cada m√≥dulo independiente, un error no afecta a otros

---

## üèóÔ∏è ARQUITECTURA

### Estructura obligatoria:
```
/modules/{nombre-modulo}/
  /components      # UI React
  /services        # L√≥gica + Supabase calls
  /hooks           # Custom React hooks
  /utils           # Helpers reutilizables
  index.js         # Export principal
```

### Separaci√≥n estricta:
- **Components**: SOLO presentaci√≥n y UI
- **Services**: TODA l√≥gica de negocio y llamadas Supabase
- **Hooks**: Estado y efectos React
- **Utils**: Funciones puras

---

## üíª STACK

- **Frontend**: React 18+
- **Backend**: Node.js + Express
- **Base de datos**: Supabase (PostgreSQL)
- **Auth**: Supabase Auth
- **Estado**: Context API
- **Estilos**: Tailwind CSS
- **Lenguaje**: JavaScript ES6+

---

## üìù CONVENCIONES

### Archivos:
- Componentes: `PascalCase.jsx` ‚Üí `ScheduleForm.jsx`
- Services: `camelCase.service.js` ‚Üí `schedule.service.js`
- Utils: `camelCase.util.js` ‚Üí `formatDate.util.js`
- Hooks: `useCamelCase.js` ‚Üí `useSchedule.js`
- Carpetas: `kebab-case` ‚Üí `/user-management`

### Funciones:
- Verbos descriptivos: `getUserData()`, `saveSchedule()`
- Booleans: `isActive`, `hasPermission`, `shouldUpdate`
- Handlers: `handleSubmit`, `handleDelete`

### Variables:
- Constantes globales: `MAX_RETRY_ATTEMPTS`
- Variables normales: `userData`, `scheduleList`

### Comentarios:
Solo para l√≥gica compleja o decisiones t√©cnicas no obvias. Preferir c√≥digo auto-explicativo.

---

## üé® TAILWIND CSS

### Uso correcto:
- Usar clases utilitarias directas, NO inline styles
- NO mezclar Tailwind con CSS custom cuando Tailwind ya lo tiene
- Extraer clases repetidas en componentes reutilizables

### Orden de clases:
Layout ‚Üí Espaciado ‚Üí Tama√±o ‚Üí Colores ‚Üí Bordes ‚Üí Efectos ‚Üí Responsive

### Mobile-first:
```javascript
className="w-full md:w-1/2 lg:w-1/3"  // Mobile ‚Üí Tablet ‚Üí Desktop
```

---

## ‚ö° SUPABASE

### Patr√≥n OBLIGATORIO para todas las operaciones:
```javascript
async function operationName() {
  try {
    const { data, error } = await supabase
      .from('table')
      .operation();
    
    if (error) throw error;
    return { success: true, data: data || [] };
  } catch (error) {
    console.error('Error:', error.message);
    return { success: false, error: error.message, data: [] };
  }
}
```

### CRUD obligatorio:
- **CREATE**: Validar ANTES de insertar, a√±adir `createdAt` e `isActive: true`
- **UPDATE**: A√±adir `updatedAt` timestamp
- **DELETE**: SOLO soft delete con `isActive: false` + `deletedAt`

### Configuraci√≥n:
```javascript
// src/config/supabase.js
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.REACT_APP_SUPABASE_URL;
const supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase env variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

**NUNCA hardcodear credenciales** - usar variables de entorno

---

## üöÄ JAVASCRIPT ES6+

### Usar caracter√≠sticas modernas:
- `const/let` (nunca `var`)
- Arrow functions
- Destructuring cuando mejore claridad
- Spread operator
- Template literals
- Optional chaining: `user?.profile?.name`
- Nullish coalescing: `value ?? defaultValue`

### Async/Await SIEMPRE con try-catch:
```javascript
async function operation() {
  try {
    const result = await someAsyncCall();
    return result;
  } catch (error) {
    console.error('Error:', error);
    return { success: false, error: error.message };
  }
}
```

### Early returns (reducir anidamiento):
```javascript
if (!user) return { error: 'User required' };
if (!user.email) return { error: 'Email required' };
return { valid: true };
```

---

## üö´ PROHIBIDO

1. **C√≥digo monol√≠tico**: M√°ximo 300 l√≠neas por archivo
2. **Operaciones sin try-catch**: Toda llamada async DEBE tener error handling
3. **Hardcodear credenciales**: Usar variables de entorno
4. **Mezclar l√≥gica y UI**: Separaci√≥n estricta
5. **Eliminar datos**: Solo soft delete
6. **Mutar estado**: Usar setState o m√©todos inmutables
7. **CSS inline con Tailwind**: Si usas Tailwind, NO uses `style={{}}`
8. **Consultas sin validar**: Validar ANTES de enviar a Supabase

---

## ‚úÖ VALIDACI√ìN OBLIGATORIA

Antes de CUALQUIER operaci√≥n de escritura:
```javascript
function validateData(data) {
  const errors = [];
  
  // 1. Campos requeridos
  if (!data.required) errors.push('Required field missing');
  
  // 2. Tipos correctos
  if (typeof data.number !== 'number') errors.push('Invalid type');
  
  // 3. Rangos v√°lidos
  if (data.value < 0) errors.push('Must be positive');
  
  // 4. Formatos (email, fecha, etc.)
  if (!isValidFormat(data.field)) errors.push('Invalid format');
  
  return { valid: errors.length === 0, errors };
}
```

---

## üîß GU√çA R√ÅPIDA

| Necesitas | Usar | NO usar |
|-----------|------|---------|
| L√≥gica de negocio | Service | Component |
| Llamadas Supabase | Service | Component |
| Estado local UI | useState | Service |
| Estado global | Context API | Props drilling |
| Transformar datos | Utils | Inline |
| Estilos | Tailwind | Inline styles |
| Validar | Service | Alerts directos |

---

## üìö PRINCIPIOS

1. **KISS**: Simplicidad sobre complejidad
2. **DRY**: C√≥digo duplicado 2+ veces ‚Üí funci√≥n reutilizable
3. **SRP**: Una funci√≥n = una responsabilidad
4. **Fail-safe**: Asumir que todo puede fallar
5. **Mobile-first**: Dise√±ar primero para m√≥vil

---

## üí¨ AL GENERAR C√ìDIGO

1. Pregunta si algo no est√° claro sobre arquitectura
2. Explica decisiones t√©cnicas importantes
3. Indica configuraciones necesarias (env vars, Supabase tables)
4. Incluye validaciones y error handling por defecto
5. **Responde siempre en espa√±ol**

**Nunca asumas. Siempre pregunta.**